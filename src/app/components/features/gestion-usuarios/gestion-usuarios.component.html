<nav class="mb-5 navbar">
  <div class="container">
    <div class="d-flex align-items-end pt-4">
      <form class="d-flex" role="search">
        <div *ngIf="rol === 'administrador'">
          <button
            type="button"
            class="btn btn-success ml-3"
            [routerLink]="['/agregarEmpleado']"
          >
            Agregar Empleado
          </button>
        </div>
      </form>
    </div>
  </div>
</nav>

<!-- <a class="mb-0 mr-4">Hola, {{ nombreCompleto }}</a> -->

<!--Tabla de usuarios-->
<div *ngIf="rol === 'administrador'" class="container">
  <h4 class="text-center pt-1">Lista de usuarios</h4>
  <br />
  <div class="table-container">
    <div class="table-responsive">
      <table class="table table-striped table-bordered">
        <!-- Encabezados de la tabla -->
        <thead class="thead-dark">
          <tr>
            <th scope="col">#</th>
            <th scope="col">
              Cedula
              <button
                type="button"
                class="btn btn-link"
                (click)="cambiarOrden('nombre')"
              >
                <!-- <i [ngClass]="{'fa fa-sort-asc': ordenAscendente, 'fa fa-sort-desc': !ordenAscendente}"></i> (NO FUNCIONA EL ASCENDENTE) -->
                <i
                  class="fa fa-arrow-up"
                  *ngIf="columnaOrden === 'nombre' && ordenAscendente"
                ></i>
                <i
                  class="fa fa-arrow-down"
                  *ngIf="columnaOrden === 'nombre' && !ordenAscendente"
                ></i>
              </button>
            </th>
            <th scope="col">Nombre</th>
            <th scope="col">Apellido</th>
            <th scope="col">Correo</th>
            <th scope="col">Rol</th>
            <th scope="col">Estado</th>
            <th scope="col">Accion</th>
          </tr>
        </thead>
        <tbody>
          <!-- Usar un índice basado en la página actual -->
          <ng-container
            *ngFor="
              let usuario of usuarios.slice(
                (paginaActual - 1) * usuariosPorPagina,
                paginaActual * usuariosPorPagina
              );
              let i = index
            "
          >
            <tr>
              <th scope="row">
                {{ (paginaActual - 1) * usuariosPorPagina + i + 1 }}
              </th>

              <td>
                {{ usuario.cedula }}
              </td>

              <td>
                <ng-container *ngIf="estaEditando(usuario)">
                  <input [(ngModel)]="usuario.nombre" class="form-control" />
                </ng-container>
                <ng-container *ngIf="!estaEditando(usuario)">
                  {{ usuario.nombre }}
                </ng-container>
              </td>

              <td>
                <ng-container *ngIf="estaEditando(usuario)">
                  <input [(ngModel)]="usuario.apellido" class="form-control" />
                </ng-container>
                <ng-container *ngIf="!estaEditando(usuario)">
                  {{ usuario.apellido }}
                </ng-container>
              </td>

              <td>
                <ng-container *ngIf="estaEditando(usuario)">
                  <input [(ngModel)]="usuario.correo" class="form-control" />
                </ng-container>
                <ng-container *ngIf="!estaEditando(usuario)">
                  {{ usuario.correo }}
                </ng-container>
              </td>

              <td>
                <ng-container *ngIf="estaEditando(usuario)">
                  <app-role-dropdown
                    [selectedRole]="usuario.rol"
                    (roleSelected)="updateUserRole($event, usuario)"
                  ></app-role-dropdown>
                </ng-container>
                <ng-container *ngIf="!estaEditando(usuario)">
                  {{ usuario.rol }}
                </ng-container>
              </td>

              <td>
                <ng-container *ngIf="estaEditando(usuario)">
                  <app-estado-dropdown
                    [estadoSeleccionado]="usuario.EstaInactivo"
                    (estadoSeleccionadoOutput)="
                      updateUserEstado($event, usuario)
                    "
                  ></app-estado-dropdown>
                </ng-container>
                <ng-container *ngIf="!estaEditando(usuario)">
                  {{ usuario.estaInactivo ? "inactivo" : "activo" }}
                </ng-container>
              </td>

              <td>
                <button
                  type="button"
                  class="btn btn-outline-success ml-3 mr-3"
                  *ngIf="!estaEditando(usuario)"
                  (click)="editarUsuario(usuario)"
                >
                  Editar
                </button>
                <div class="d-flex flex-row">
                  <button
                    type="button"
                    class="btn btn-outline-primary ml-3 mr-3"
                    *ngIf="estaEditando(usuario)"
                    (click)="guardarCambios(usuario)"
                  >
                    Guardar
                  </button>
                  <button
                    type="button"
                    class="btn btn-outline-danger ml-3 mr-3"
                    *ngIf="estaEditando(usuario)"
                    (click)="cancelarEdicion(usuario)"
                  >
                    Cancelar
                  </button>
                </div>
              </td>
            </tr>
          </ng-container>
        </tbody>
      </table>
    </div>
    <!-- Controles de paginación -->
    <div class="d-flex justify-content-center">
      <ul class="pagination">
        <li
          class="page-item"
          *ngFor="let pagina of calcularPaginas(); let i = index"
        >
          <a class="page-link" (click)="cambiarPagina(i + 1)">{{ i + 1 }}</a>
        </li>
      </ul>
    </div>
  </div>
</div>
